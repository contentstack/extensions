<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link href="https://www.contentstack.com/sdks/contentstack-ui-extensions/dist/1.1.0/ui-extension-sdk.min.css" rel="stylesheet" type="text/css" media="all">
  <style media="all">
.field-label{color:#4f6471;font-size:15px!important}.form-control{color:#748590;height:35px!important;max-width:255px!important}.container{padding-top:15px}.thumbnail{width:100%;height:100%}.select2-results__option{width:20%;float:left}img.img-thumbnail{max-height:126px}#run-btn{width:103px;margin-top:5px;margin-bottom:20px}#run-btn img{vertical-align:sub;margin-right:10px}#run-btn[disabled]{width:160px}.cs-form-group{margin-bottom:35px}label{font-weight:400;font-size:14px;color:#4f6470}.badge-info{background:#f0f9fe;border-radius:3px;font-size:14px;color:#6c7982;border:1px solid #c9dde2;white-space:normal}.keys{font-size:14px;color:#748490;width:34%;margin-bottom:10px;display:inline-block}.count-value{font-size:14px;color:#748490}.list-group-item{background-color:#fff;border:none;padding-left:0}.result-li{border-bottom:1px solid rgba(0,0,0,.125)}#result-container{max-height:360px;overflow:auto;padding-bottom:25px}body{max-height:600px;overflow:auto}.result-wrapper{border-bottom:2px solid rgba(0,0,0,.125)}#result-container::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}#result-container::-webkit-scrollbar{width:5px;background-color:transparent}#result-container::-webkit-scrollbar-thumb{border-radius:6px;background-color:#dfe2e9;cursor:pointer}.alert-danger{display:block;font-size:12px;color:#f77d7a;text-align:left;padding-top:0;padding-left:0;margin-top:-10px;background-color:transparent;border:0}
</style>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script src="https://www.contentstack.com/sdks/contentstack-ui-extensions/dist/1.1.0/ui-extension-sdk.js"></script>
</head>
<body>
  <div class="container">
    <div class="cs-form-group">
      <label for="models" class="field-label">Select Model</label>
      <select class="form-control" id="models"></select>
    </div>
    <div class="cs-form-group">
      <label for="field" class="field-label">Field</label>
      <select class="form-control" id="field"></select>
    </div>
    <button type="submit" id="run-btn" class="btn cs-btn-primary"><img src="https://images.contentstack.io/v3/assets/bltc249966903dc3407/blt40a60d26b3d8095f/5b7660b25b9f14da0eb07a34/operation.svg" alt="run-icon">Run</button>
  </div>
  <div class="container" id="result-container">
    <ul class="list-group" id="result-list">
    </ul>
  </div>
  <script>
let models={retail_classifer:{name:"Retail Classifier",path:"/v3/classifiers/cl_mmYLCZUN/classify/",type:"classifications"},business_classifier:{name:"Business Classifier",path:"/v3/classifiers/cl_5vWJMjGc/classify/",type:"classifications"},profanity_and_abuse_detection:{name:"Profanity & Abuse Detection",path:"/v3/classifiers/cl_KFXhoTdt/classify/",type:"classifications"},language_classifier:{name:"Language Classifier",path:"/v3/classifiers/cl_v2GCwYhf/classify/",type:"classifications"},news_classifier:{name:"News Classifier",path:"/v3/classifiers/cl_WDyr2Q4F/classify/",type:"classifications"},sentiment_analysis:{name:"Sentiment Analysis",path:"/v3/classifiers/cl_Jx8qzYJh/classify/",type:"classifications"},product_sentiment:{name:"Product Sentiment",path:"/v3/classifiers/cl_TWmMTdgQ/classify/",type:"classifications"},nps_saas_topic:{name:"NPS SaaS Feedback Classifier",path:"/v3/classifiers/cl_gYDZjEnS/classify/",type:"classifications"},outbound_sales_classifier:{name:"Outbound Sales Classifier",path:"/v3/classifiers/cl_zSDSt8QP/classify/",type:"classifications"},commerce_cs_classifier:{name:"E-Commerce Customer Support Classifier",path:"/v3/classifiers/cl_GhPhiVYE/classify/",type:"classifications"},keyword_extraction:{name:"Keyword Extraction",path:"/v3/extractors/ex_y7BPYzNG/extract/",type:"extractions"},summarizer:{name:"Summarizer",path:"/v3/extractors/ex_94WD2XxD/extract/",type:"extractions"},insight_extraction:{name:"Insight Extraction",path:"/v3/extractors/ex_EjosnyKK/extract/",type:"extractions"},person_extraction:{name:"Person Extraction",path:"/v3/extractors/ex_SmwSdZ3C/extract/",type:"extractions"},location_extraction:{name:"Location Extraction",path:"/v3/extractors/ex_vqBQ7V9B/extract/",type:"extractions"},company_extraction:{name:"Company Extraction",path:"/v3/extractors/ex_A9nCcXfn/extract/",type:"extractions"},date_time_extraction:{name:"Date Time Extraction",path:"/v3/extractors/ex_LPxHGwJT/extract/",type:"extractions"},price_extraction:{name:"Price Extraction",path:"/v3/extractors/ex_wNDME4vE/extract/",type:"extractions"},url_extraction:{name:"URL Extraction",path:"/v3/extractors/ex_owGiMc4z/extract/",type:"extractions"},email_extraction:{name:"Email Address Extraction",path:"/v3/extractors/ex_YWBmKCP9/extract/",type:"extractions"},email_cleaner:{name:"Email Cleaner",path:"/v3/extractors/ex_BXqiifAi/extract/",type:"extractions"},phone_number_extraction:{name:"Phone Number Extraction",path:"/v3/extractors/ex_ktEPNd9V/extract/",type:"extractions"}},fieldPaths=[];function renderModelSelectField(){$.each(models,(e,t)=>{$("#models").append($("<option></option>").attr("value",e).text(t.name))})}function renderFieldSelectField(e){let a=$("#field").val();$("#field").empty(),fieldPaths=getPaths(e.entry.content_type,e.entry.getData()),fieldPaths.forEach(e=>{let t=$("<option></option>").attr("value",e.uid).text(e.titlePaths.join(" > "));a===e.uid&&t.attr("selected","selected"),$("#field").append(t)})}function getPaths(e,t){let i=[];return function l(e,a,t,o,p=[]){let s=t?t.split("."):[];e.forEach((n,e)=>{let r=[...s,n.uid],c=r.join(".");var t;a&&void 0!==a[n.uid]&&("text"===n.data_type&&(!1===n.multiple?(t=o||c,i.push({uid:c,path:r,value:a[n.uid],setuid:t,titlePaths:[...p,n.display_name]})):0<a[n.uid].length&&a[n.uid].forEach((e,t)=>{let a=[...r,t];a.join(".");var s=o||c;i.push({uid:a.join("."),path:a,value:e,setuid:s,titlePaths:[...p,n.display_name,t]})})),"group"===n.data_type&&(!1===n.multiple?l(n.schema,a[n.uid],c,o,[...p,n.display_name]):0<a[n.uid].length&&a[n.uid].forEach((e,t)=>{let a=[...r,t];l(n.schema,e,a.join("."),o,[...p,n.display_name,t])})),"blocks"===n.data_type&&0<a[n.uid].length&&a[n.uid].forEach((e,t)=>{let a=[...r,t],s=Object.keys(e)[0];var i=n.blocks.find(e=>e.uid===s).schema,e=e[s];o=c,l(i,e,a.join("."),o,[...p,n.display_name,t])}))})}(e.schema,t),i}function domChangeListner(e){e.entry.onSave(()=>renderFieldSelectField(e)),$("#run-btn").on("click",()=>{var t=$("#models").val();$("#run-btn").prop("disabled",!0),$("#run-btn").html("Working on it..."),$("#result-container").html(""),runAnalysis(t,fieldPaths.find(e=>e.uid===$("#field").val()).value,e.config.token).then(e=>{$("#run-btn").prop("disabled",!1),$("#run-btn").html(""),$("#run-btn").append('<img src="https://images.contentstack.io/v3/assets/bltc249966903dc3407/blt40a60d26b3d8095f/5b7660b25b9f14da0eb07a34/operation.svg" alt="run-icon"/> Run'),renderResult(e,models[t])}).catch(e=>{console.log(e),$("#run-btn").prop("disabled",!1),$("#run-btn").html(""),$("#run-btn").append('<img src="https://images.contentstack.io/v3/assets/bltc249966903dc3407/blt40a60d26b3d8095f/5b7660b25b9f14da0eb07a34/operation.svg" alt="run-icon"/> Run'),$("#result-container").append('<div class="alert alert-danger" role="alert">'+e.message+"</div>")})})}function runAnalysis(s,e,i){let n;return new Promise((t,a)=>{fetch(`https://api.monkeylearn.com${models[s].path}`,{method:"POST",body:JSON.stringify({data:[e]}),headers:{Authorization:"Token "+i,"Content-Type":"application/json"}}).then(e=>(e.headers.get("X-Query-Limit-Remaining")&&$("#result-container").append("<label>Result:</label>"),n=e.status,e.json())).then(e=>{throw 200===n&&t(e[0]),Error("Failed to run "+models[s].name+": "+e.detail)}).catch(e=>{a(e)})})}function renderResult(e,t){if($("#result-container").append('<ul class="list-group" id="result-list"></ul>'),e&&0!==e[t.type].length||$("#result-list").append('<li class="list-group-item result-li">No Results</li>'),"classifications"===t.type)return e[t.type].forEach(function(e,t){e="<li class='list-group-item'><div><span class='keys'>Tag : </span><span class='badge badge-info'>"+e.tag_name+"</span> </br> <span class='keys'> Confidence:</span> <span class='count-value'>"+(100*e.confidence).toFixed(2)+"% </span></div></li>";$("#result-list").append(e)});"extractions"===t.type&&e[t.type].forEach(function(e,t){let a="<li class='list-group-item'><div class='result-wrapper'><span class='keys'>"+e.tag_name+" :</span> <span class='badge badge-info'>";a+=e.parsed_value+"</span> ",e.relevance&&(a+="</br><span class='keys'> Relevance :</span>"+(100*e.relevance).toFixed(2)+"%</span> "),e.count&&(a+="</br><span class='keys'> Count :</span>"+e.count+"</span> "),a+="</div></li>",$("#result-list").append(a)})}$(document).ready(function(){ContentstackUIExtension.init().then(function(e){e.window.enableAutoResizing(),renderModelSelectField(),renderFieldSelectField(e),domChangeListner(e)})});
</script>
</body>
</html>