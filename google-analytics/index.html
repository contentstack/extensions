<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8">
<link href="https://www.contentstack.com/sdks/contentstack-ui-extensions/dist/1.1.0/ui-extension-sdk.css" rel="stylesheet" type="text/css" media="all">
<style>
.tbl{margin-left:0}.errormsg{font-family:Arial,Helvetica,sans-serif;font-weight:700;margin-left:0;margin-right:0;margin-top:30px;background-color:#eff1f4;width:100%;height:auto;font-size:23px;text-align:center}#tag{margin:0 5px 5px 15px;background-color:#fff;width:85px}#loader{display:none;margin-left:45%;margin-top:50%}.metric-details{margin-top:5px;margin-left:10%}.line{height:2px;color:#efefef;margin-top:24px;margin-left:20px;margin-right:20px;margin-bottom:24px}#link{display:none}p{font-size:14px;margin:0}h1{color:#4f6471;font-size:24px;margin:0;line-height:1}a{text-decoration:none;color:#4f6471}a:hover{color:#25bd9f}
</style>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script src="https://www.contentstack.com/sdks/contentstack-ui-extensions/dist/1.1.0/ui-extension-sdk.js"></script>
</head><body>
  <table class="tbl">
  <tr>
  <td><button type="button" id="tag" class="btn cs-btn-primary" onclick="loadIntervalData(1,this)">1 day</button></td>
  <td><button type="button" id="tag" class="btn cs-btn-primary" onclick="loadIntervalData(7,this)">7 days</button></td>
  <td><button type="button" id="tag" class="btn cs-btn-primary" onclick="loadIntervalData(15,this)">15 days</button></td></tr>
  <tr>
  <td><button type="button" id="tag" class="btn cs-btn-primary" onclick="loadIntervalData(30,this)">30 days</button></td>
  <td><button type="button" id="tag" class="btn cs-btn-primary" onclick="loadIntervalData(180,this)">180 days</button></td>
  <td><button type="button" id="tag" class="btn cs-btn-primary" onclick="loadIntervalData(365,this)">365 days</button></td></tr>
  </table>
  <div id="error" class="errormsg">
  </div>
  <div id="loader" class="reference-loading">
     <div class="loading-flash">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>
  </div>
 <div id="canvasbody">
 </div>	
 <script>
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}var extensionField,analytics,pagePath,Analytics=function(){function n(e){var t=e.url,a=e.view_id,e=e["x-api-key"];_classCallCheck(this,n),this.baseUrl=t,this.viewId=a,this.xApiKey=e}return _createClass(n,[{key:"getData",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:30,a=this,n={};return a.xApiKey&&(n["x-api-key"]=a.xApiKey),fetch("".concat(a.baseUrl,"?view_id=").concat(a.viewId,"&start_date=").concat(t,"daysAgo&end_date=today&metrics=ga:pageviews,ga:uniquePageviews,ga:users,ga:newUsers,ga:avgTimeOnPage,ga:pageLoadTime,ga:bounceRate&dimensions=ga:date&filters=ga:pagePath==").concat(e),{method:"GET",headers:n}).then(function(e){if(200===e.status)return e.json();throw new Error("Error in fetching data.</br>Please check extension configuration.")}).catch(function(e){return Promise.reject(e)})}}]),n}();function toggleLoader(e){document.getElementById("loader").style.display=e?"block":"none"}function toggleButtons(e){for(var t=document.getElementsByClassName("btn cs-btn-primary"),a=0;a<t.length;a+=1)t[a].disabled=e;toggleLoader(e)}function formatDate(e){var t=e[0]+e[1]+e[2]+e[3],a=e[4]+e[5],e=e[6]+e[7];return"".concat(t,"-").concat(a,"-").concat(e)}function addPadding(e){return(1===e.length?"0":"").concat(e)}function formatTime(e){var t=e,a=((t%=86400)/3600).toFixed(),e=((t%=3600)/60).toFixed(),t=(t%=60).toFixed();return"".concat(addPadding(a),":").concat(addPadding(e),":").concat(addPadding(t))}function drawChart(e,t){e=google.visualization.arrayToDataTable(e);new google.visualization.AreaChart(document.getElementById("chart_container_"+t)).draw(e,{hAxis:{textPosition:"none"},vAxis:{minValue:0},legend:"none",colors:["#098ec8"]})}function renderMetric(e,t,a,n){document.getElementById("canvasbody").innerHTML+='<div class="metric-details"><p>'.concat(n,"</p><h1>").concat(t,'</h1></div><div id="chart_container_').concat(a,'"></div><hr class="line">'),google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(drawChart.bind(null,e,a))}function displayError(e){document.getElementById("error").innerHTML="<p>".concat(e,"</p>")}function renderData(e){for(var t=e.totalsForAllResults["ga:pageviews"],a=e.totalsForAllResults["ga:uniquePageviews"],n=e.totalsForAllResults["ga:users"],r=e.totalsForAllResults["ga:newUsers"],o=e.totalsForAllResults["ga:avgTimeOnPage"],s=e.totalsForAllResults["ga:pageLoadTime"],i=e.totalsForAllResults["ga:bounceRate"],c=[["year","count"]],l=[["year","count"]],d=[["year","count"]],u=[["year","count"]],g=[["year","count"]],m=[["year","count"]],y=[["year","count"]],f=e.rows.length,h=0;h<f;h+=1)c.push([formatDate(e.rows[h][0]),Number(e.rows[h][1])]),l.push([formatDate(e.rows[h][0]),Number(e.rows[h][2])]),d.push([formatDate(e.rows[h][0]),Number(e.rows[h][3])]),u.push([formatDate(e.rows[h][0]),Number(e.rows[h][4])]),g.push([formatDate(e.rows[h][0]),Number(e.rows[h][5])]),m.push([formatDate(e.rows[h][0]),Number(e.rows[h][6])]),y.push([formatDate(e.rows[h][0]),Number(e.rows[h][7])]);Number(t)||Number(a)||Number(n)||Number(r)||Number(o)||Number(s)||Number(i)?(document.getElementById("error").innerHTML="",document.getElementById("link").style.display="block",renderMetric(c,t,1,"Pageviews"),renderMetric(l,a,2,"Unique Pageviews"),renderMetric(d,n,3,"Users"),renderMetric(u,r,4,"New Users"),renderMetric(g,formatTime(o),5,"Avg. Time on Page"),renderMetric(m,formatTime(s),6,"Page Load Time"),renderMetric(y,i+"%",7,"Bounce Rate")):(document.getElementById("canvasbody").innerHTML=" ",document.getElementById("link").style.display="none",displayError("No data available"))}function loadIntervalData(e,t){document.getElementById("error").innerHTML=" ",document.getElementById("link").style.display="none",document.getElementById("canvasbody").innerHTML="";for(var a=document.getElementsByClassName("btn cs-btn-primary"),t=t,n=0;n<a.length;n+=1)a[n].style.backgroundColor="white";t.style.backgroundColor="#e6eaf2",toggleButtons(!0),analytics.getData(pagePath,e).then(function(e){renderData(e),toggleButtons(!1)}).catch(function(e){displayError(e.message),toggleButtons(!1)})}ContentstackUIExtension.init().then(function(e){var t=document.getElementsByClassName("btn cs-btn-primary");pagePath=(extensionField=e).entry.getField("url").getData(),analytics=new Analytics(extensionField.config),loadIntervalData(30,t[3])});
</script>
 <center id="link">View full report on <a href="https://analytics.google.com/analytics/web/" target="_blank">Google Analytics</a></center>
 </body>
</html>